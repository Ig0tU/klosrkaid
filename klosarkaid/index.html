<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    <title>AI Arcade | Kyklos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Icons and Styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/frames.css">
    
    <!-- Security headers -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://asim.sh; frame-src https://asim.sh; script-src 'self' https://asim.sh https://cdn.tailwindcss.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://fonts.gstatic.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com;">
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #10b981;
            --dark: #1e293b;
            --light: #f8fafc;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0f172a;
            color: var(--light);
        }
        
        .game-card {
            transition: all 0.3s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        
        .game-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            border-radius: 1rem;
            z-index: -1;
        }
        
        .arcade-font {
            font-family: 'Press Start 2P', cursive;
        }
        
        .pixel-border {
            position: relative;
        }
        
        .pixel-border::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 3px solid var(--primary);
            border-radius: 0.5rem;
            z-index: -1;
            animation: borderPulse 2s infinite;
        }
        
        @keyframes borderPulse {
            0% { border-color: var(--primary); }
            50% { border-color: var(--secondary); }
            100% { border-color: var(--primary); }
        }
        
        .neon-text {
            text-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px var(--primary), 0 0 20px var(--primary);
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-1rem); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-indigo-900 to-emerald-900 py-4 px-6 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-robot text-3xl text-indigo-300"></i>
                <h1 class="text-2xl font-bold arcade-font neon-text">AI ARCADE</h1>
            </div>
            <button id="connectWalletBtn" disabled
                class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-all duration-300 flex items-center space-x-2 pixel-border">
                <i class="fab fa-ethereum"></i>
                <span>Connect Wallet</span>
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-indigo-900/30 to-emerald-900/30 z-0"></div>
        <div class="container mx-auto px-6 py-16 relative z-10">
            <div class="flex flex-col lg:flex-row items-center">
                <div class="lg:w-1/2 mb-10 lg:mb-0">
                    <h1 class="text-4xl md:text-6xl font-bold mb-6 arcade-font text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-emerald-400">
                        WELCOME TO THE FUTURE OF GAMING
                    </h1>
                    <p class="text-lg text-gray-300 mb-8">
                        Experience cutting-edge AI-powered games and tools. Connect your MetaMask wallet holding KLOS tokens to unlock the full arcade experience.
                    </p>
                    <div class="flex space-x-4">
                        <button id="heroConnectBtn" disabled
                            class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 flex items-center space-x-2">
                            <i class="fab fa-ethereum"></i>
                            <span>Connect Wallet</span>
                        </button>
                        <button class="bg-transparent border-2 border-emerald-500 hover:bg-emerald-900/30 text-emerald-400 font-bold py-3 px-6 rounded-lg transition-all duration-300 flex items-center space-x-2">
                            <i class="fas fa-info-circle"></i>
                            <span>Learn More</span>
                        </button>
                    </div>
                </div>
                <div class="lg:w-1/2 flex justify-center">
                    <div class="relative floating">
                        <div class="w-64 h-64 md:w-80 md:h-80 bg-indigo-900/50 rounded-full flex items-center justify-center border-4 border-emerald-400/30">
                            <div class="w-56 h-56 md:w-72 md:h-72 bg-emerald-900/50 rounded-full flex items-center justify-center border-4 border-indigo-400/30">
                                <i class="fas fa-gamepad text-6xl md:text-8xl text-white opacity-70"></i>
                            </div>
                        </div>
                        <div class="absolute -top-4 -left-4 w-16 h-16 bg-indigo-500 rounded-full blur-xl"></div>
                        <div class="absolute -bottom-4 -right-4 w-16 h-16 bg-emerald-500 rounded-full blur-xl"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Wallet Status -->
    <div id="walletStatus" class="container mx-auto px-6 py-4 hidden">
        <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-4 border-l-4 border-indigo-500 shadow-lg">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center">
                        <i class="fab fa-ethereum text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-white">Wallet Connected</h3>
                        <p id="walletAddress" class="text-sm text-gray-300 truncate max-w-xs">0x0000...0000</p>
                    </div>
                </div>
                <div id="tokenStatus" class="flex items-center space-x-2">
                    <span class="text-sm font-medium px-3 py-1 rounded-full bg-gray-700 text-gray-300">Checking tokens...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Grid -->
    <section class="container mx-auto px-6 py-12">
        <h2 class="text-3xl font-bold mb-8 text-center arcade-font text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-emerald-400">
            SELECT YOUR GAME
        </h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Video/Image Generation -->
            <div class="game-card bg-slate-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700 relative">
                <div class="game-frame-container h-48">
                    <iframe class="game-frame" src="about:blank" data-src="https://asim.sh/frame/180092" title="Video/Image Generation"></iframe>
                    <button class="fullscreen-toggle">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-bold mb-2">AI Image Generator</h3>
                    <p class="text-gray-300 mb-4">Create stunning AI-generated images and videos.</p>
                    <button class="game-access-btn w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center space-x-2">
                        <i class="fas fa-lock"></i>
                        <span>Create</span>
                    </button>
                </div>
                <div class="absolute top-4 right-4 bg-emerald-600 text-xs font-bold px-2 py-1 rounded-full">
                    NEW
                </div>
            </div>
            
            <!-- NFTftw -->
            <div class="game-card bg-slate-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700 relative">
                <div class="game-frame-container h-48">
                    <iframe class="game-frame" src="about:blank" data-src="https://asim.sh/frame/198227" title="NFTftw"></iframe>
                    <button class="fullscreen-toggle">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-bold mb-2">NFT Creator</h3>
                    <p class="text-gray-300 mb-4">Generate and mint unique NFT collections.</p>
                    <button class="game-access-btn w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center space-x-2">
                        <i class="fas fa-lock"></i>
                        <span>Create NFTs</span>
                    </button>
                </div>
            </div>
            
            <!-- Botnet Creator -->
            <div class="game-card bg-slate-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700 relative">
                <div class="game-frame-container h-48">
                    <iframe class="game-frame" src="about:blank" data-src="https://asim.sh/frame/194190/" title="Botnet Creator"></iframe>
                    <button class="fullscreen-toggle">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-bold mb-2">AI Network</h3>
                    <p class="text-gray-300 mb-4">Create and manage AI agent networks.</p>
                    <button class="game-access-btn w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center space-x-2">
                        <i class="fas fa-lock"></i>
                        <span>Launch</span>
                    </button>
                </div>
            </div>
            
            <!-- PetVet -->
            <div class="game-card bg-slate-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700 relative">
                <div class="game-frame-container h-48">
                    <iframe class="game-frame" src="about:blank" data-src="https://asim.sh/frame/194464" title="PetVet With Image Analysis"></iframe>
                    <button class="fullscreen-toggle">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-bold mb-2">PetVet AI</h3>
                    <p class="text-gray-300 mb-4">AI-powered pet health analysis and recommendations.</p>
                    <button class="game-access-btn w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center space-x-2">
                        <i class="fas fa-lock"></i>
                        <span>Analyze</span>
                    </button>
                </div>
            </div>
            
            <!-- ZeroSearch -->
            <div class="game-card bg-slate-800/50 backdrop-blur-sm rounded-xl overflow-hidden border border-slate-700 relative">
                <div class="game-frame-container h-48">
                    <iframe class="game-frame" src="about:blank" data-src="https://asim.sh/frame/191134/" title="ZeroSearch"></iframe>
                    <button class="fullscreen-toggle">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-bold mb-2">ZeroSearch</h3>
                    <p class="text-gray-300 mb-4">Offline-capable AI search engine.</p>
                    <button class="game-access-btn w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 flex items-center justify-center space-x-2">
                        <i class="fas fa-lock"></i>
                        <span>Search</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="bg-gradient-to-b from-slate-900 to-slate-800 py-16">
        <div class="container mx-auto px-6">
            <h2 class="text-3xl font-bold mb-12 text-center arcade-font text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-emerald-400">
                WHY PLAY IN THE AI ARCADE?
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700">
                    <div class="w-12 h-12 bg-indigo-600 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-bolt text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Cutting-Edge AI</h3>
                    <p class="text-gray-300">Our games feature state-of-the-art machine learning models that adapt and evolve as you play.</p>
                </div>
                
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700">
                    <div class="w-12 h-12 bg-emerald-600 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-coins text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Blockchain Rewards</h3>
                    <p class="text-gray-300">Earn KLOS tokens by playing and achieving milestones in our games.</p>
                </div>
                
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl p-6 border border-slate-700">
                    <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-users text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Community Driven</h3>
                    <p class="text-gray-300">Help shape the future of the arcade through governance proposals and feedback.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-slate-900/80 backdrop-blur-sm border-t border-slate-800 py-8">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                <div class="flex items-center space-x-2">
                    <img src="/icon-192.png" alt="Kyklos Logo" class="w-8 h-8">
                    <span class="text-xl font-bold arcade-font">KYKLOS</span>
                </div>
                
                <!-- Social Links -->
                <div class="flex space-x-6">
                    <a href="https://tiktok.com/@getkyklos" target="_blank" rel="noopener noreferrer" 
                       class="text-gray-400 hover:text-white transition-colors">
                        <i class="fab fa-tiktok text-xl"></i>
                    </a>
                    <a href="https://twitter.com/getkyklos" target="_blank" rel="noopener noreferrer" 
                       class="text-gray-400 hover:text-white transition-colors">
                        <i class="fab fa-x-twitter text-xl"></i>
                    </a>
                    <a href="https://instagram.com/getkyklos" target="_blank" rel="noopener noreferrer" 
                       class="text-gray-400 hover:text-white transition-colors">
                        <i class="fab fa-instagram text-xl"></i>
                    </a>
                    <a href="https://reddit.com/r/kyklos" target="_blank" rel="noopener noreferrer" 
                       class="text-gray-400 hover:text-white transition-colors">
                        <i class="fab fa-reddit text-xl"></i>
                    </a>
                </div>
                
                <div class="text-sm text-gray-400">
                    Â© 2025 Kyklos. All rights reserved.
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@metamask/detect-provider/dist/detect-provider.min.js"></script>
    <script src="/js/wallet.js"></script>
    <script src="/js/frames.js"></script>
    
    <!-- Initialize Wallet and PWA -->
    <script>
        // Function to initialize frames after wallet connection
        const initializeFrames = () => {
            document.querySelectorAll('.game-frame').forEach(frame => {
                const src = frame.getAttribute('data-src');
                if (src) {
                    frame.src = src;
                }
            });
        };

        const waitForLibraries = async () => {
            console.log('Waiting for libraries...');
            const timeout = 5000; // 5 seconds timeout
            const start = Date.now();
            
            while (!window.ethers || !window.detectEthereumProvider) {
                if (Date.now() - start > timeout) {
                    throw new Error('Required libraries failed to load');
                }
                console.log('Waiting for libraries to load...');
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            console.log('All libraries loaded successfully');
            
            // Test detectEthereumProvider directly
            console.log('Testing detectEthereumProvider...');
            try {
                const provider = await window.detectEthereumProvider();
                console.log('Direct provider test result:', {
                    provider: provider ? 'Found' : 'Not found',
                    isEthereum: provider === window.ethereum,
                    ethereumExists: !!window.ethereum
                });
            } catch (error) {
                console.error('Direct provider test error:', error);
            }
        };

        const initializeApp = async () => {
            try {
                console.log('Starting app initialization...');
                
                // Wait for required libraries
                await waitForLibraries();
                console.log('Libraries loaded and verified');
                
                // Create wallet manager instance
                console.log('Creating WalletManager instance...');
                window.walletManager = new WalletManager();
                console.log('WalletManager instance created');
                
                // Initialize wallet manager
                console.log('Initializing WalletManager...');
                const initResult = await window.walletManager.init();
                console.log('WalletManager initialization result:', initResult);
                
                // Make wallet manager globally accessible
                window.walletManagerGlobal = window.walletManager;
                console.log('WalletManager assigned to global scope');
                
                // Initialize service worker
                if ('serviceWorker' in navigator) {
                    try {
                        const registration = await navigator.serviceWorker.register('/sw.js');
                        console.log('ServiceWorker registration successful');
                    } catch (err) {
                        console.error('ServiceWorker registration failed:', err);
                    }
                }
                
                console.log('App initialization completed successfully');
            } catch (error) {
                console.error('App initialization error:', error);
                if (window.walletManager) {
                    window.walletManager.showError(error.message);
                }
            }
        };

        // Ensure DOM is loaded before starting initialization
        console.log('Current document.readyState:', document.readyState);
        if (document.readyState === 'loading') {
            console.log('DOM still loading, adding DOMContentLoaded listener');
            document.addEventListener('DOMContentLoaded', () => {
                console.log('DOMContentLoaded fired, starting initialization');
                initializeApp();
            });
        } else {
            console.log('DOM already loaded, starting initialization immediately');
            initializeApp();
        }
    </script>
